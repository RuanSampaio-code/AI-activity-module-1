<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8">
  <title>Agentes Coletando Recursos</title>
  <link rel="stylesheet" href="style.css">
  <style>
    body {
      font-family: Arial, sans-serif;
      display: flex;
      justify-content: center;
      align-items: flex-start;
      height: 100vh;
      margin: 0;
      background-color: #f0f0f0;
    }
    .container {
      display: flex;
      gap: 30px;
      align-items: flex-start;
    }
    .painel-esquerdo {
      min-width: 220px;
    }
    .grid {
      display: grid;
      grid-template-columns: repeat(10, 30px);
      grid-template-rows: repeat(10, 30px);
      gap: 2px;
      background-color: #fff;
      padding: 10px;
      border: 1px solid #ccc;
    }
    .cell {
      width: 30px;
      height: 30px;
      text-align: center;
      line-height: 30px;
      border: 1px solid #ccc;
      font-size: 14px;
    }
    .agent { background-color: #4caf50; color: white; font-weight: bold; }
    .goal { background-color: #f44336; color: white; font-weight: bold; }
    .cristal { background-color: #00bcd4; }
    .metal { background-color: #ff9800; }
    .estrutura { background-color: #9c27b0; }
    .base { background-color: #607d8b; color: white; }
    button {
      margin: 5px 0;
      padding: 6px 12px;
      font-size: 14px;
      cursor: pointer;
    }
    .legenda {
      margin-top: 20px;
    }
    .legenda div {
      margin-bottom: 5px;
    }
  </style>
</head>
<body>
  <div class="container">
    <div class="painel-esquerdo">
      <h3>Pontuação</h3>
      <p><strong>Agente Aleatório (A):</strong> <span id="scoreA">0</span></p>
      <p><strong>Agente com Estado (S):</strong> <span id="scoreS">0</span></p>
      <p><strong>Agente por Objetivo (G):</strong> <span id="scoreG">0</span></p>
      <hr>
      <p><strong>Total:</strong> <span id="scoreTotal">0</span></p>
    </div>

    <div class="grid" id="grid"></div>

    <div id="panel">
      <h3>Painel de Controle</h3>
      <button onclick="iniciarSimulacao()">Iniciar</button><br>
      <button onclick="pausarSimulacao()">Pausar</button><br>
      <button onclick="novaColeta()">Nova Coleta</button>
      <div class="legenda">
        <h4>Legenda</h4>
        <div><span class="cell cristal">C</span> Cristais Energéticos (10 pts)</div>
        <div><span class="cell metal">M</span> Blocos de Metal Raro (20 pts)</div>
        <div><span class="cell estrutura">E</span> Estruturas Antigas (50 pts)</div>
        <div><span class="cell base">B</span> Base dos agentes</div>
        <div><span class="cell agent">A</span> Agente Aleatório</div>
        <div><span class="cell agent">S</span> Agente com Estado</div>
        <div><span class="cell goal">G</span> Agente Baseado em Objetivos</div>
      </div>
    </div>
  </div>

  <script>
    const gridSize = 10;
    const grid = document.getElementById("grid");
    const scoreADisplay = document.getElementById("scoreA");
    const scoreSDisplay = document.getElementById("scoreS");
    const scoreGDisplay = document.getElementById("scoreG");
    const scoreTotalDisplay = document.getElementById("scoreTotal");

    let scoreA = 0, scoreS = 0, scoreG = 0;
    let intervalo = null;

    const recursoTipos = {
      'C': { class: 'cristal', valor: 10 },
      'M': { class: 'metal', valor: 20 },
      'E': { class: 'estrutura', valor: 50 },
    };

    const mapa = [];
    const base = { x: 0, y: 0 };
    let agente = { x: 0, y: 0 };
    let agenteEstado = { x: 0, y: 0, memoria: new Set() };
    let agenteObjetivo = {
      x: 0, y: 0,
      carregando: false,
      alvo: null
    };

    function criarMapa() {
      for (let i = 0; i < gridSize; i++) {
        mapa[i] = [];
        for (let j = 0; j < gridSize; j++) {
          let tipo = '.';
          const rand = Math.random();
          if (rand < 0.1) tipo = 'C';
          else if (rand < 0.15) tipo = 'M';
          else if (rand < 0.18) tipo = 'E';
          mapa[i][j] = tipo;
        }
      }
      mapa[base.x][base.y] = 'B';
      agente = { x: base.x, y: base.y };
      agenteEstado = { x: base.x, y: base.y, memoria: new Set([`${base.x},${base.y}`]) };
      agenteObjetivo = { x: base.x, y: base.y, carregando: false, alvo: null };
    }

    function renderMapa() {
      grid.innerHTML = '';
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const div = document.createElement("div");
          div.className = "cell";

          const isA = agente.x === i && agente.y === j;
          const isS = agenteEstado.x === i && agenteEstado.y === j;
          const isG = agenteObjetivo.x === i && agenteObjetivo.y === j;

          if (isG) {
            div.classList.add("goal");
            div.textContent = "G";
          } else if (isA) {
            div.classList.add("agent");
            div.textContent = "A";
          } else if (isS) {
            div.classList.add("agent");
            div.textContent = "S";
          } else {
            const val = mapa[i][j];
            if (val === 'B') {
              div.classList.add("base");
              div.textContent = "B";
            } else if (recursoTipos[val]) {
              div.classList.add(recursoTipos[val].class);
              div.textContent = val;
            }
          }

          grid.appendChild(div);
        }
      }
    }

    function atualizarPontuacoes() {
      scoreADisplay.textContent = scoreA;
      scoreSDisplay.textContent = scoreS;
      scoreGDisplay.textContent = scoreG;
      scoreTotalDisplay.textContent = scoreA + scoreS + scoreG;
    }

    function moverAleatorio() {
      const dir = [[0,1],[0,-1],[1,0],[-1,0]];
      const [dx, dy] = dir[Math.floor(Math.random()*4)];
      agente.x = Math.max(0, Math.min(gridSize - 1, agente.x + dx));
      agente.y = Math.max(0, Math.min(gridSize - 1, agente.y + dy));
    }

    function moverComEstado() {
      const dir = [[0,1],[0,-1],[1,0],[-1,0]];
      const opcoes = dir.map(([dx,dy]) => [agenteEstado.x+dx, agenteEstado.y+dy])
        .filter(([x,y]) =>
          x >= 0 && y >= 0 && x < gridSize && y < gridSize &&
          !agenteEstado.memoria.has(`${x},${y}`)
        );
      const [nx, ny] = opcoes.length > 0 ?
        opcoes[Math.floor(Math.random()*opcoes.length)] :
        [Math.max(0,Math.min(gridSize-1, agenteEstado.x + dir[0][0])), Math.max(0,Math.min(gridSize-1, agenteEstado.y + dir[0][1]))];
      agenteEstado.x = nx;
      agenteEstado.y = ny;
      agenteEstado.memoria.add(`${nx},${ny}`);
    }

    function moverObjetivo() {
      if (!agenteObjetivo.carregando) {
        if (!agenteObjetivo.alvo || mapa[agenteObjetivo.alvo.x][agenteObjetivo.alvo.y] === '.') {
          agenteObjetivo.alvo = encontrarRecursoMaisProximo();
        }
        if (agenteObjetivo.alvo) {
          moverPara(agenteObjetivo, agenteObjetivo.alvo);
          if (agenteObjetivo.x === agenteObjetivo.alvo.x && agenteObjetivo.y === agenteObjetivo.alvo.y) {
            agenteObjetivo.carregando = true;
            agenteObjetivo.tipoColetado = mapa[agenteObjetivo.x][agenteObjetivo.y];
            mapa[agenteObjetivo.x][agenteObjetivo.y] = '.';
          }
        }
      } else {
        moverPara(agenteObjetivo, base);
        if (agenteObjetivo.x === base.x && agenteObjetivo.y === base.y) {
          scoreG += recursoTipos[agenteObjetivo.tipoColetado].valor;
          agenteObjetivo.carregando = false;
          agenteObjetivo.alvo = null;
          atualizarPontuacoes();
        }
      }
    }

    function encontrarRecursoMaisProximo() {
      let menor = null;
      let dist = Infinity;
      for (let i = 0; i < gridSize; i++) {
        for (let j = 0; j < gridSize; j++) {
          const val = mapa[i][j];
          if (val === 'C' || val === 'M') {
            const d = Math.abs(i - agenteObjetivo.x) + Math.abs(j - agenteObjetivo.y);
            if (d < dist) {
              menor = { x: i, y: j };
              dist = d;
            }
          }
        }
      }
      return menor;
    }

    function moverPara(agente, destino) {
      const dx = destino.x - agente.x;
      const dy = destino.y - agente.y;
      if (dx !== 0) agente.x += dx / Math.abs(dx);
      else if (dy !== 0) agente.y += dy / Math.abs(dy);
    }

    function coletarRecurso() {
      const c = mapa[agente.x][agente.y];
      if (recursoTipos[c]) {
        scoreA += recursoTipos[c].valor;
        mapa[agente.x][agente.y] = '.';
        atualizarPontuacoes();
      }
    }

    function coletarRecursoEstado() {
      const c = mapa[agenteEstado.x][agenteEstado.y];
      if (recursoTipos[c]) {
        scoreS += recursoTipos[c].valor;
        mapa[agenteEstado.x][agenteEstado.y] = '.';
        atualizarPontuacoes();
      }
    }

    function ciclo() {
      moverAleatorio(); coletarRecurso();
      moverComEstado(); coletarRecursoEstado();
      moverObjetivo();
      renderMapa();
    }

    function iniciarSimulacao() {
      if (!intervalo) intervalo = setInterval(ciclo, 700);
    }

    function pausarSimulacao() {
      clearInterval(intervalo); intervalo = null;
    }

    function novaColeta() {
      scoreA = scoreS = scoreG = 0;
      atualizarPontuacoes();
      criarMapa(); renderMapa();
    }

    criarMapa(); renderMapa();
  </script>
</body>
</html>
